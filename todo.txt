todo insert hook calls at the proper places


